erDiagram
    Categories {
        int CategoryID PK
        nvarchar CategoryName "UNIQUE"
        nvarchar Description
        bit IsActive
        datetime CreatedDate
        int CreatedBy FK "default 1"
    }

    Facts {
        int FactID PK
        int CategoryID FK
        nvarchar Content
        date DateAdded
        int TotalViews "global"
        int CreatedBy FK "default 1"
    }

    ReviewSessions {
        int SessionID PK
        int ProfileID FK
        datetime StartTime
        datetime EndTime
        int DurationSeconds
        bit TimedOut
        int FactsAdded
        int FactsEdited
        int FactsDeleted
    }

    ReviewLogs {
        int ReviewLogID PK
        int FactID FK
        datetime ReviewDate
        int SessionDuration
        int SessionID FK
        bit TimedOut
        nvarchar Action
        bit FactEdited
        bit FactDeleted
        nvarchar FactContentSnapshot
        int CategoryIDSnapshot
    }

    ProfileFacts {
        int ProfileFactID PK
        int ProfileID FK
        int FactID FK
        int PersonalReviewCount
        bit IsFavorite
        bit IsEasy
        datetime LastViewedByUser
    }

    GamificationProfile {
        int ProfileID PK
        int XP
        int Level
        int TotalReviews
        int TotalKnown
        int TotalFavorites
        int TotalAdds
        int TotalEdits
        int TotalDeletes
        int TotalAITokens
        decimal TotalAICost
        int CurrentStreak
        int LongestStreak
        date LastCheckinDate
    }

    Achievements {
        int AchievementID PK
        nvarchar Code "UNIQUE"
        nvarchar Name
        nvarchar Category
        int Threshold
        int RewardXP
        datetime CreatedDate
    }

    AchievementUnlocks {
        int UnlockID PK
        int AchievementID FK
        int ProfileID FK
        datetime UnlockDate
        bit Notified
    }

    AIUsageLogs {
        int AIUsageID PK
        int FactID FK
        int SessionID FK
        int ProfileID FK
        nvarchar OperationType
        nvarchar Status
        nvarchar ModelName
        nvarchar Provider
        int InputTokens
        int OutputTokens
        int TotalTokens
        decimal Cost
        char CurrencyCode
        int LatencyMs
        datetime CreatedAt
    }

    %% Relationships (GamificationProfile as user identity)
    GamificationProfile ||--o{ ReviewSessions : owns
    GamificationProfile ||--o{ AchievementUnlocks : earns
    GamificationProfile ||--o{ AIUsageLogs : incurs
    GamificationProfile ||--o{ ProfileFacts : "tracks state"
    Facts ||--o{ ProfileFacts : "has state"

    Categories ||--o{ Facts : contains
    Facts ||--o{ ReviewLogs : logs
    ReviewSessions ||--o{ ReviewLogs : tracks
    Achievements ||--o| AchievementUnlocks : unlocks
    
    Facts ||--o{ AIUsageLogs : "AI Explanations"
    ReviewSessions ||--o{ AIUsageLogs : "AI Costs"
