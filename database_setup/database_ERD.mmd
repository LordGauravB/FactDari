erDiagram
    GamificationProfile {
        int ProfileID PK
        int XP
        int Level
        int TotalReviews
        int TotalKnown
        int TotalFavorites
        int TotalAdds
        int TotalEdits
        int TotalDeletes
        int TotalAITokens
        decimal TotalAICost
        int CurrentStreak
        int LongestStreak
        date LastCheckinDate
    }

    Categories {
        int CategoryID PK
        nvarchar CategoryName "UNIQUE"
        nvarchar Description
        bit IsActive
        datetime CreatedDate
        int CreatedBy FK "default 1"
    }

    Facts {
        int FactID PK
        int CategoryID FK
        nvarchar Content
        nvarchar ContentKey "Computed/Persisted"
        date DateAdded
        int TotalViews
        int CreatedBy FK "default 1"
    }

    ProfileFacts {
        int ProfileFactID PK
        int ProfileID FK
        int FactID FK
        int PersonalReviewCount
        bit IsFavorite
        bit IsEasy
        datetime LastViewedByUser
        datetime KnownSince "First marked as known"
    }

    ReviewSessions {
        int SessionID PK
        int ProfileID FK
        datetime StartTime
        datetime EndTime
        int DurationSeconds
        bit TimedOut
        int FactsAdded
        int FactsEdited
        int FactsDeleted
    }

    FactLogs {
        int FactLogID PK
        int FactID FK
        datetime ReviewDate
        int SessionDuration
        int SessionID FK
        bit TimedOut
        nvarchar Action
        bit FactEdited
        bit FactDeleted
        nvarchar FactContentSnapshot
        int CategoryIDSnapshot
    }

    AIUsageLogs {
        int AIUsageID PK
        int FactID FK
        int SessionID FK
        int ProfileID FK
        nvarchar OperationType
        nvarchar Status
        nvarchar ModelName
        nvarchar Provider
        int InputTokens
        int OutputTokens
        int TotalTokens "Computed"
        decimal Cost
        char CurrencyCode
        int LatencyMs
        int ReadingDurationSec
        datetime CreatedAt
    }

    Achievements {
        int AchievementID PK
        nvarchar Code "UNIQUE"
        nvarchar Name
        nvarchar Category
        int Threshold
        int RewardXP
        datetime CreatedDate
    }

    AchievementUnlocks {
        int UnlockID PK
        int AchievementID FK
        int ProfileID FK
        datetime UnlockDate
        bit Notified
    }

    %% --- Core Relationships ---
    GamificationProfile ||--o{ ReviewSessions : owns
    GamificationProfile ||--o{ AchievementUnlocks : earns
    GamificationProfile ||--o{ AIUsageLogs : incurs
    GamificationProfile ||--o{ ProfileFacts : "tracks state"
    
    %% --- Creator Tracking (Added these based on SQL FKs) ---
    GamificationProfile ||--o{ Categories : "creates"
    GamificationProfile ||--o{ Facts : "creates"

    %% --- Content Structure ---
    Categories ||--o{ Facts : contains
    Facts ||--o{ ProfileFacts : "has state"
    
    %% --- Logging & History ---
    Facts ||--o{ FactLogs : logs
    ReviewSessions ||--o{ FactLogs : tracks
    
    %% --- AI ---
    Facts ||--o{ AIUsageLogs : "AI Context"
    ReviewSessions ||--o{ AIUsageLogs : "AI Session"

    %% --- Gamification ---
    Achievements ||--o{ AchievementUnlocks : unlocks